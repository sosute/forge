# PROJECT GOALS - VAISC CSV フォーマット策定プロジェクト

## 🎯 プロジェクトのゴール

Google Vertex AI Search for Commerce (VAISC) を利用したアパレル商品のフリーワード検索機能を実現するための、最適なCSVデータフォーマットを策定する。

## 📋 背景と概要

### システム構成
- **検索エンジン**: Google Vertex AI Search for Commerce (VAISC)
- **データソース**: アパレル商品データベース
- **データ形式**: CSV形式でGCS (Google Cloud Storage) にアップロード
- **インポート方法**: GCSからVAISCへのデータインポート

### プロジェクトの必要性
効果的な商品検索を実現するためには、VAISCが提供する機能を最大限活用できるデータ構造が必要。そのため、既存の商品DBスキーマとVAISCの要件を適切にマッピングしたCSVフォーマットを定義する必要がある。

## 🎯 成果物

1. **CSVデータフォーマット仕様書**
   - ヘッダー定義
   - 各フィールドのデータ型と形式
   - 必須/任意フィールドの定義
   - データ例

2. **データマッピングドキュメント**
   - 既存DBフィールド → CSVフィールドのマッピング
   - データ変換ルール
   - 注意事項

## 📊 必要な情報の整理

### 1. VAISCで実現したい機能

**既存のsearch/menu API (factor=freeword) からの移行要件**

✅ **基本検索機能** ← 既存API仕様から確認済み
  - フリーワード検索（`q`パラメータ、+区切りで複数キーワード）
  - 絞り込みキーワード（`adw`パラメータ、検索後の追加絞り込み）
  - 除外キーワード（`exq`パラメータ、特定キーワードを除外）

✅ **取得情報** ← 既存レスポンスから確認済み
  - 商品ID（`productId`）
  - 商品名（`productName1`）
  - ブランド名（`brandTextJP`, `brandTextEN`）
  - 価格情報（`taxInclusivePrice`, `oldPrice`, `discountRate`）
  - 画像URL（`imageURL`）
  - 商品詳細URL（`detailUrl`）
  - カテゴリ名（`scdName`）
  - ユーザー評価（`evaluationAverage`, `commentCount`）
  - お気に入り数（`favoriteCount`）
  - 各種フラグ情報（flags内の14種類のブーリアン値）

✅ **フィルタ機能** ← 既存パラメータから確認済み
  - カテゴリ階層フィルタ（`store`, `fcd`, `scd`）
  - 性別フィルタ（`figure`）
  - ブランドフィルタ（`bcd`）
  - 価格帯フィルタ（`price`: 下限_上限形式）
  - サイズフィルタ（`size`）
  - カラーフィルタ（`color`）
  - 割引率フィルタ（`offrate`）
  - 特徴フィルタ（`kwd`: グループ_キーワード形式）
  - 日付フィルタ（`new_date`, `sale_date`）
  - 各種フラグフィルタ（arrival, sale, gift等）

- [ ] **ソート機能** ← 詳細仕様要確認
  - 既存APIの`sortby`パラメータの詳細値を確認必要
  - 想定：関連度順、価格順、新着順、人気順等

✅ **その他の機能** ← 既存仕様から確認済み
  - ページング（`page`, `per`）
  - 色展開表示制御（`full`: 代表色/全色）
  - 特定ブランド表示制御（`display_dreni`）

**追加で検討可能な機能（VAISC活用）**
- [ ] 検索候補表示（suggest API相当）
- [ ] ファセット検索（検索結果の動的集計）
- [ ] 類似商品検索
- [ ] パーソナライズドレコメンデーション

### 2. 商品関連DBのTABLE情報

✅ **テーブル構造の確認完了** ← `docs/db-schema-table-info.md`で整理済み
  - 商品マスタ項目: **91項目**を確認
  - 主要カテゴリ:
    - 商品基本情報: 商品型番、URL、価格、ブランド等
    - カテゴリ情報: ストア、第1/第2アイテムコード等
    - 商品属性: 素材、カラー、サイズ、キーワード等
    - フラグ情報: 14種類のアイコンフラグ（値下げ、セール、新着等）
    - 検索制御: フリーワード検索除外、表示フラグ等
    - ユーザー情報: コメント数、評価、お気に入り数等
  - **カット対象項目**: 11項目（「カット」区分の項目）
  - **有効項目**: 80項目（VAISC用CSV出力対象）

### 3. VAISC仕様の確認
- [ ] VAISCのスキーマ要件
  - 必須フィールド
  - 推奨フィールド
  - データ型の制約
  - 最大/最小値の制限

## 📝 作業ステップ

1. **情報収集フェーズ**
   - VAISCで実現したい機能の詳細定義
   - 既存DB構造の詳細分析
   - VAISC仕様書の確認

2. **分析フェーズ**
   - 機能要件とDB構造のギャップ分析
   - データ変換要件の洗い出し
   - パフォーマンス要件の確認

3. **設計フェーズ**
   - CSVフォーマットの初版作成
   - データマッピングの定義
   - サンプルデータの作成

4. **検証フェーズ**
   - フォーマットの妥当性確認
   - サンプルデータでのテスト
   - 必要に応じた修正

## 📁 関連ファイル

- **既存の分析資料**
  - `input/VAISC：フロントAPI対応.xlsx`
  - `input/丸井商品データ_VAISCスキーマ加工案.xlsx`
  - `output/VAISC_search_API_仕様書.md`
  - `output/丸井商品データ_VAISCスキーマ仕様書.md`

- **参考資料**
  - `reference/db-schema/20250828_商品マスタ項目・データ.xlsx`
  - `reference/vaisc-api-functions/20240819.MARUI-722-swagger_api.yml`

## 📅 更新履歴

- 2024-01-XX: プロジェクトゴール文書作成

---

**次のアクション**: VAISCで実現したい機能の詳細をヒアリングし、このドキュメントに追記していく