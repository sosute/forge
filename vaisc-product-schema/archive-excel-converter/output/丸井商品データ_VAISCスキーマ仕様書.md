# VAISC スキーマ設計書（丸井商品データ）

Google Cloud Vertex AI Search for Retailに対応した丸井商品マスタのスキーマ設計です。

## 📊 概要
- **基本フィールド**: 51個
- **商品属性**: 64個
- **対象システム**: Vertex AI Search for Retail

## 🔧 基本フィールド

| No. | フィールド名 | 型 | 必須 | 説明 | 丸井マスタ |
|-----|-------------|-----|------|------|----------|
| 1 | `name` | STRING | 🟡 | 商品名 |  |
| 2 | `id` | STRING | 🔴 | 商品ID | 代表色表示用商品ID：商品型番\n全色表示用商品ID：商品型番＋カラーコード |
| 3 | `type` | STRING | 🟡 | 商品タイプ | PRIMARY（固定） |
| 4 | `primaryProductId` | STRING | 🟡 | 親商品のID（バリエーションの場合など） | 商品型番 |
| 5 | `collectionMemberIds` | STRING | 🔄 | コレクションメンバーのID | ？？？ |
| 6 | `gtin` | STRING | 🟡 | GTIN（国際取引商品番号） | JANコード |
| 7 | `categories` | STRING | 🔄 | 商品カテゴリ | アイテム・カテゴリ名称 |
| 8 | `title` | STRING | 🔴 | 商品タイトル | 商品名１\_ngram |
| 9 | `brands` | STRING | 🔄 | ブランド名 | メインブランド名称(日本語) |
| 10 | `description` | STRING | 🟡 | 商品の説明 | キャプション\_形態素 |
| 11 | `languageCode` | STRING | 🟡 | 言語コード | ？？？ |
| 332 | `tags` | STRING | 🔄 | タグ | フリーワードタグ |
| 333 | `priceInfo` | RECORD | 🟡 | 価格情報 |  |
| 334 | `↳ currencyCode` | STRING | 🟡 | 通貨コード |  |
| 335 | `↳ price` | FLOAT | 🟡 | 販売価格 | 販売価格 |
| 336 | `↳ originalPrice` | FLOAT | 🟡 | 元の価格 | 二重表示用価格 |
| 337 | `↳ cost` | FLOAT | 🟡 | 原価 | ― |
| 338 | `↳ priceEffectiveTime` | STRING | 🟡 | 価格の有効開始時間 | 価格の開始時間 |
| 339 | `↳ priceExpireTime` | STRING | 🟡 | 価格の有効期限時間 | 価格の終了時間 |
| 340 | `rating` | RECORD | 🟡 | 評価情報 |  |
| 341 | `↳ ratingCount` | INTEGER | 🟡 | 評価数 | ユーザーコメント数 |
| 342 | `↳ averageRating` | FLOAT | 🟡 | 平均評価点 | ユーザー評価平均 |
| 343 | `↳ ratingHistogram` | INTEGER | 🔄 | 評価のヒストグラム（例：1〜5段階の各評価の数） | ― |
| 344 | `expireTime` | STRING | 🟡 | 有効期限時間 | 公開を終了する商品には過去のタイムスタンプを設定 |
| 345 | `ttl` | RECORD | 🟡 | TTL（Time-to-Live）情報 | ？？？ |
| 346 | `↳ seconds` | INTEGER | 🟡 | TTLの秒数 |  |
| 347 | `↳ nanos` | INTEGER | 🟡 | TTLのナノ秒数 |  |
| 348 | `availableTime` | STRING | 🟡 | 利用可能になる時間 | 商品公開開始時間 |
| 349 | `availability` | STRING | 🟡 | 在庫状況 | 在庫0ならOUT\_OF\_STOCK,在庫1以上ならIN\_STOCK |
| 350 | `availableQuantity` | INTEGER | 🟡 | 在庫数 | 在庫のレコード単位での充足率 |
| 351 | `fulfillmentInfo` | RECORD | 🔄 | フルフィルメント情報（配送方法など） | ― |
| 352 | `↳ type` | STRING | 🟡 | フルフィルメントのタイプ | ― |
| 353 | `↳ placeIds` | STRING | 🔄 | 場所ID | ― |
| 354 | `uri` | STRING | 🟡 | 商品のURI（Uniform Resource Identifier） | 商品詳細URL |
| 355 | `images` | RECORD | 🔄 | 画像情報 | サムネイルキャッチコピー |
| 356 | `↳ uri` | STRING | 🔴 | 画像のURI | 代表色表示用商品ID：メイン画像\n代表色表示用商品ID：カラー画像 |
| 357 | `↳ height` | INTEGER | 🟡 | 画像の高さ | ― |
| 358 | `↳ width` | INTEGER | 🟡 | 画像の幅 | ― |
| 359 | `audience` | RECORD | 🟡 | ターゲット層情報 |  |
| 360 | `↳ genders` | STRING | 🔄 | 性別 | メイン性別 |
| 361 | `↳ ageGroups` | STRING | 🔄 | 年齢層 | アフィリエイト単品情報からもってこれる？ |
| 362 | `colorInfo` | RECORD | 🟡 | 色情報 |  |
| 363 | `↳ colorFamilies` | STRING | 🔄 | 色の系統 | カラーID |
| 364 | `↳ colors` | STRING | 🔄 | 色名 | カラー検索用 |
| 365 | `sizes` | STRING | 🔄 | サイズ | サイズ検索用 |
| 366 | `materials` | STRING | 🔄 | 素材 | 素材 |
| 367 | `patterns` | STRING | 🔄 | 柄 | ？？？ |
| 368 | `conditions` | STRING | 🔄 | 商品の状態 | new(固定) |
| 369 | `publishTime` | STRING | 🟡 | 公開時間 | 商品公開開始時間 |
| 370 | `promotions` | RECORD | 🔄 | プロモーション情報 |  |
| 371 | `↳ promotionId` | STRING | 🟡 | プロモーションID | アフィリエイトクーポン情報からもってこれる？ |

## 🏷️ 商品属性 (attributes)

各商品属性は以下の共通構造を持ちます：
```
attributes: {
  key: "属性名"
  value: {
    text: ["テキスト値"]
    numbers: [数値]
  }
}
```

### 🎯 属性一覧

| No. | 丸井マスタ項目 | 説明 |
|-----|-------------|------|
| 12 | **代表色フラグ** | 商品の属性情報 |
| 17 | **詳細サイズ用・部位ID** | 商品の属性情報 |
| 22 | **キーワードID** | 商品の属性情報 |
| 27 | **キーワードテキスト** | 商品の属性情報 |
| 32 | **割引率** | 商品の属性情報 |
| 37 | **第一アイテムコード** | 商品の属性情報 |
| 42 | **第二アイテムコード** | 商品の属性情報 |
| 47 | **第一アイテムコードソート順** | 商品の属性情報 |
| 52 | **第二アイテムコードソート順** | 商品の属性情報 |
| 57 | **アイテムカテゴリ名称** | 商品の属性情報 |
| 62 | **ストアID** | 商品の属性情報 |
| 67 | **対象性別** | 商品の属性情報 |
| 72 | **原産国** | 商品の属性情報 |
| 77 | **対象性別** | 商品の属性情報 |
| 82 | **メインブランドID** | 商品の属性情報 |
| 87 | **メインブランド名称(英語)** | 商品の属性情報 |
| 92 | **メインブランド頭文字** | 商品の属性情報 |
| 97 | **ブランド検索時に表示するテキスト** | 商品の属性情報 |
| 102 | **セレクトショッププラグ** | 商品の属性情報 |
| 107 | **関連ブランドコード** | 商品の属性情報 |
| 112 | **関連ブランド名称(日本語)** | 商品の属性情報 |
| 117 | **関連ブランド名称(英語)** | 商品の属性情報 |
| 122 | **ECショップコード** | 商品の属性情報 |
| 127 | **ショップカテゴリー名称（日本語）** | 商品の属性情報 |
| 132 | **ショップカテゴリー名称（英語）** | 商品の属性情報 |
| 137 | **アイコンフラグ（フラグID）** | 商品の属性情報 |
| 142 | **アイコンフラグ-値下げ** | 商品の属性情報 |
| 147 | **アイコンフラグ-セール** | 商品の属性情報 |
| 152 | **アイコンフラグ-ギフトラッピング** | 商品の属性情報 |
| 157 | **アイコンフラグ-再入荷商品** | 商品の属性情報 |
| 162 | **アイコンフラグ-新着商品** | 商品の属性情報 |
| 167 | **アイコンフラグ- 期間限定セール** | 商品の属性情報 |
| 172 | **アイコンフラグ- 販促キャンペーン** | 商品の属性情報 |
| 177 | **アイコンフラグ-配送料無料** | 商品の属性情報 |
| 182 | **まとめ割引アイコンフラグ** | 商品の属性情報 |
| 187 | **まとめ割引適用下限商品点数** | 商品の属性情報 |
| 192 | **まとめ割引OFF率** | 商品の属性情報 |
| 197 | **シークレット販売フラグ** | 商品の属性情報 |
| 202 | **先行予約商品のフラグ** | 商品の属性情報 |
| 207 | **クーポンフラグ** | 商品の属性情報 |
| 212 | **サムネイル表示対象販促メッセージ情報** | 商品の属性情報 |
| 217 | **先行予約商品のフラグ** | 商品の属性情報 |
| 222 | **キャンペーンID** | 商品の属性情報 |
| 227 | **検索結果表示フラグ** | 商品の属性情報 |
| 232 | **フリーワード検索除外フラグ** | 商品の属性情報 |
| 237 | **レコメンド結果表示フラグ** | 商品の属性情報 |
| 242 | **ランキング結果表示フラグ** | 商品の属性情報 |
| 247 | **サムネイルカラー** | 商品の属性情報 |
| 252 | **サムネイルサイズ** | 商品の属性情報 |
| 257 | **ユーザーお気に入り登録数** | 商品の属性情報 |
| 262 | **フロアID** | 商品の属性情報 |
| 267 | **ショップID** | 商品の属性情報 |
| 272 | **PCショップ名** | 商品の属性情報 |
| 277 | **PCショップ名（日本語）** | 商品の属性情報 |
| 282 | **ショップ頭文字** | 商品の属性情報 |
| 287 | **ショップ検索時に表示するテキスト** | 商品の属性情報 |
| 292 | **WEBショップID** | 商品の属性情報 |
| 297 | **WEBショップ名** | 商品の属性情報 |
| 302 | **WEBショップ検索時に表示するテキスト** | 商品の属性情報 |
| 307 | **取引先型番** | 商品の属性情報 |
| 312 | **第２カテゴリ x ブランド x 色** | 商品の属性情報 |
| 317 | **第２カテゴリ x ブランド x サイズ** | 商品の属性情報 |
| 322 | **サイズID** | 商品の属性情報 |
| 327 | **サイズ名テキスト** | 商品の属性情報 |

## ⚠️ 必須フィールド

### id
- **説明**: 商品ID
- **丸井マスタ**: 代表色表示用商品ID：商品型番\n全色表示用商品ID：商品型番＋カラーコード
- **補足**: 【公式ドキュメント】\n・商品データベースで使用される商品IDです。ID フィールドはカタログ全体で一意である必要があります。\n・ユーザーイベントを記録する場合に同じ値を使用する必要があります。\n・検索APIの search メソッドとレコメンデーションAPIの predict メソッドによって同じ値が返されます。\n\n【DC補足】\n・元データにプライマリ商品がなくバリエーション商品のみあ...

### title
- **説明**: 商品タイトル
- **丸井マスタ**: 商品名１\_ngram
- **補足**: 【公式ドキュメント】\n商品データベースで使用される商品名（商品タイトル）です。UTF-8 でエンコードされた 1250 文字以内の文字列で指定します。...

### ↳ uri
- **説明**: 画像のURI
- **丸井マスタ**: 代表色表示用商品ID：メイン画像\n代表色表示用商品ID：カラー画像
- **補足**: 【DC補足】\nスキーマ上では画像URLのカラムは必須項目となっています。...

## 🔍 主要な商品属性の詳細

### 代表色フラグ

**スキーマ構造:**
```json
{
  "key": "代表色フラグ",
  "value": {
    "text": ["値"],
    "numbers": [数値] // 該当する場合
  }
}
```

### 詳細サイズ用・部位ID

**スキーマ構造:**
```json
{
  "key": "詳細サイズ用・部位ID",
  "value": {
    "text": ["値"],
    "numbers": [数値] // 該当する場合
  }
}
```

### アイテムカテゴリ名称

**スキーマ構造:**
```json
{
  "key": "アイテムカテゴリ名称",
  "value": {
    "text": ["値"],
    "numbers": [数値] // 該当する場合
  }
}
```

### ストアID

**スキーマ構造:**
```json
{
  "key": "ストアID",
  "value": {
    "text": ["値"],
    "numbers": [数値] // 該当する場合
  }
}
```

### 対象性別

**スキーマ構造:**
```json
{
  "key": "対象性別",
  "value": {
    "text": ["値"],
    "numbers": [数値] // 該当する場合
  }
}
```

### 原産国

**スキーマ構造:**
```json
{
  "key": "原産国",
  "value": {
    "text": ["値"],
    "numbers": [数値] // 該当する場合
  }
}
```

### 対象性別

**スキーマ構造:**
```json
{
  "key": "対象性別",
  "value": {
    "text": ["値"],
    "numbers": [数値] // 該当する場合
  }
}
```

## 📖 実装ガイド

### データ投入時の注意点
1. **商品ID (id)**: カタログ全体で一意である必要があります
2. **商品タイトル (title)**: 検索性を考慮した適切な商品名を設定
3. **attributes**: 最大30個の属性まで設定可能
4. **マッピング**: 丸井マスタの項目名と対応するattributeのkeyを一致させる

### 検索最適化のポイント
- **categories**: 階層構造で詳細なカテゴリパスを設定
- **title, description**: 検索キーワードを含む自然な文章
- **brands**: ブランド名は統一された形式で設定

---
*Generated by Improved VAISC Schema Processor*