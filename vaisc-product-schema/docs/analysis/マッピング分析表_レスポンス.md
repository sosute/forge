# VAISC レスポンスマッピング分析表

## 📋 分析概要

**目的**: 既存search/menu APIレスポンス構造をVAISC統合エンドポイントで再現する際のフィールド対応関係の精査  
**根拠**: VAISCから既存APIレスポンス形式への変換における互換性確保とフィールドマッピングの明確化

## 📝 表記規則

**データ加工要否の判定**:
- **※同値**: DBデータとAPIデータが同一の場合（加工不要）
- **具体値**: データ変換・加工が必要な場合（変換ロジックが必要）
- **❌**: 対応するフィールドが存在しない場合

## 🔍 Search APIレスポンスマッピング

### 商品基本情報レスポンス

| データ項目 | 既存APIレスポンスフィールド | サンプルAPIデータ | DBフィールド | サンプルDBデータ | VAISCフィールド | サンプルVAISCデータ |
|-----------|---------------------------|-----------------|-------------|----------------|-----------------|-------------------|
| 商品識別子 | `productId` | `"CF0212351201"` | `s_product_id` | ※同値 | `product.id` | ※同値 |
| 商品詳細URL | `detailUrl` | `"https://voi.0101.co.jp/..."` | `url` | ※同値 | `product.uri` | ※同値 |
| 商品名 | `productName1` | `"ニットTシャツ"` | `n_product_name_1` | ※同値 | `product.title` | ※同値 |
| ブランド名 | `productName2` | `"アイテムズ アーバンリサーチ"` | `n_product_name_2` | ※同値 | `product.brands[0]` | ※同値 |
| 商品画像URL | `imageURL` | `"https://image.0101.co.jp/..."` | `s_thumb_img` | ※同値 | `product.images[0].uri` | ※同値 |
| カテゴリ名 | `scdName` | `"ニット・セーター"` | `t_item_code_text` | ※同値 | `product.categories[-1]` | ※同値 |

### ブランド情報レスポンス

| データ項目 | 既存APIレスポンスフィールド | サンプルAPIデータ | DBフィールド | サンプルDBデータ | VAISCフィールド | サンプルVAISCデータ |
|-----------|---------------------------|-----------------|-------------|----------------|-----------------|-------------------|
| ブランド名（日本語） | `brandTextJP` | `"アイテムズ アーバンリサーチ"` | `s_web_brand_code_text_jp` | ※同値 | `product.brands[0]` | ※同値 |
| ブランド名（英語） | `brandTextEN` | `"ITEMS URBAN RESEARCH"` | `s_web_brand_code_text_en` | ※同値 | `product.attributes.brand_name_en.text[0]` | ※同値 |
| ブランドコード | ブランドコード（内部使用） | `"30095"` | `s_web_brand_code` | ※同値 | `product.attributes.brand_code.text[0]` | ※同値 |

### 価格情報レスポンス

| データ項目 | 既存APIレスポンスフィールド | サンプルAPIデータ | DBフィールド | サンプルDBデータ | VAISCフィールド | サンプルVAISCデータ |
|-----------|---------------------------|-----------------|-------------|----------------|-----------------|-------------------|
| 税込価格 | `taxInclusivePrice` | `4990` | `i_tax_inclusive_price` | ※同値 | `product.priceInfo.price` | ※同値 |
| 定価 | `oldPrice` | `5490` | `i_old_price` | ※同値 | `product.priceInfo.originalPrice` | ※同値 |
| 割引率 | `discountRate` | `9` | `i_discount_rate` | ※同値 | `product.attributes.discount_rate.numbers[0]` | ※同値 |

### ユーザー評価情報レスポンス

| データ項目 | 既存APIレスポンスフィールド | サンプルAPIデータ | DBフィールド | サンプルDBデータ | VAISCフィールド | サンプルVAISCデータ |
|-----------|---------------------------|-----------------|-------------|----------------|-----------------|-------------------|
| コメント数 | `commentCount` | `2` | `i_comment_count` | ※同値 | `product.attributes.comment_count.numbers[0]` | ※同値 |
| 平均評価値 | `evaluationAverage` | `4.5` | `f_evaluation_average` | ※同値 | `product.attributes.evaluation_average.numbers[0]` | ※同値 |
| お気に入り数 | `favoriteCount` | `2` | `i_favorite_count` | ※同値 | `product.attributes.favorite_count.numbers[0]` | ※同値 |

### 商品フラグレスポンス

| データ項目 | 既存APIレスポンスフィールド | サンプルAPIデータ | DBフィールド | サンプルDBデータ | VAISCフィールド | サンプルVAISCデータ |
|-----------|---------------------------|-----------------|-------------|----------------|-----------------|-------------------|
| 値下げフラグ | `flags.pricereduced` | `true` | `i_icon_flag_pricereduced` | `1` | `product.attributes.flag_pricereduced.text[0]` | `1→"true"変換` |
| セールフラグ | `flags.sale` | `false` | `i_icon_flag_sale` | `0` | `product.attributes.flag_sale.text[0]` | `0→"false"変換` |
| 新着フラグ | `flags.newarrival` | `true` | `i_icon_flag_newarrival` | `1` | `product.attributes.flag_newarrival.text[0]` | `1→"true"変換` |
| 再入荷フラグ | `flags.rearrival` | `false` | `i_icon_flag_rearrival` | `0` | `product.attributes.flag_rearrival.text[0]` | `0→"false"変換` |
| ギフト可フラグ | `flags.giftwrap` | `false` | `i_icon_flag_giftwrap` | `0` | `product.attributes.flag_giftwrap.text[0]` | `0→"false"変換` |
| 期間限定フラグ | `flags.limitedsale` | `false` | `i_icon_flag_limitedsale` | `0` | `product.attributes.flag_limitedsale.text[0]` | `0→"false"変換` |
| 販促フラグ | `flags.salespromotion` | `false` | `i_icon_flag_salespromotion` | `0` | `product.attributes.flag_salespromotion.text[0]` | `0→"false"変換` |
| 送料無料フラグ | `flags.deliveryfeeoff` | `false` | `i_icon_flag_deliveryfeeoff` | `0` | `product.attributes.flag_deliveryfeeoff.text[0]` | `0→"false"変換` |
| シークレットセール | `flags.secretsale` | `false` | `i_icon_flag_secretsell` | `0` | `product.attributes.flag_secretsale.text[0]` | `0→"false"変換` |
| 予約可フラグ | `flags.reservation` | `false` | `i_icon_flag_reservation` | `0` | `product.attributes.flag_reservation.text[0]` | `0→"false"変換` |
| 中古フラグ | `flags.used` | `false` | `i_icon_flag_used` | `0` | `product.attributes.flag_used.text[0]` | `0→"false"変換` |
| クーポン対象フラグ | `flags.coupon` | `false` | `i_icon_flag_coupon` | `0` | `product.attributes.flag_coupon.text[0]` | `0→"false"変換` |
| まとめ割フラグ | `flags.bulkdiscount` | `true` | `i_icon_flag_bulk_discount` | `1` | `product.attributes.flag_bulkdiscount.text[0]` | `1→"true"変換` |
| 再値下げフラグ | `flags.pricerereduced` | `❌` | ❌ DBフィールド不明 | ❌ | ❌ | ❌ |

### 特別機能レスポンス

| データ項目 | 既存APIレスポンスフィールド | サンプルAPIデータ | DBフィールド | サンプルDBデータ | VAISCフィールド | サンプルVAISCデータ |
|-----------|---------------------------|-----------------|-------------|----------------|-----------------|-------------------|
| まとめ割メッセージ | `bulkDiscountMessage` | `"2点以上で10%OFF"` | `i_bulk_discount_apply_low_lm_goods_qty`, `i_bulk_discount_rate` | 最小数量: `2`, 割引率: `10` | `product.attributes.bulk_discount_min_qty.numbers[0]`, `product.attributes.bulk_discount_rate.numbers[0]` | `"2点以上で10%OFF"` (数量・割引率→メッセージ生成) |
| クーポンサムネイル | `couponThumbnail` | `❌` | ❌ DBフィールドなし | ❌ | ❌ | ❌ |

### カラー表示機能レスポンス

| データ項目 | 既存APIレスポンスフィールド | サンプルAPIデータ | DBフィールド | サンプルDBデータ | VAISCフィールド | サンプルVAISCデータ |
|-----------|---------------------------|-----------------|-------------|----------------|-----------------|-------------------|
| 代表色表示（`full=0`時のみレスポンス） | `colorProducts` (代表色) | `{"colorId": "brown", "colorName": "ブラウン"}` | カラーID: `sm_color_id`, カラー名: `sm_color_search` | ID: `"brown"`, 名称: `"ブラウン"` | `product.attributes.color_id.text[0]`, `product.colorInfo.colors[0]` | `{"colorId": "brown", "colorName": "ブラウン"}` (オブジェクト構造変換) |
| 全色表示（`full=1`時は`colorProducts=null`） | `colorProducts` | `null` | ❌ `full=1`では使用されない | ❌ | ❌ 全カラー情報は個別商品レスポンスで提供 | `null` |

### ページング・メタ情報レスポンス

| データ項目 | 既存APIレスポンスフィールド | サンプルAPIデータ | DBフィールド | サンプルDBデータ | VAISCフィールド | サンプルVAISCデータ |
|-----------|---------------------------|-----------------|-------------|----------------|-----------------|-------------------|
| 現在のページ番号 | `nowPage` | `1` | ❌ VAISC計算 | `VAISC計算` | `response.pagination.currentPage` | `VAISC計算` |
| 1ページあたりの件数 | `per` | `20` | ❌ VAISC計算 | `VAISC計算` | `response.pagination.pageSize` | `VAISC計算` |
| 総商品数 | `total` | `847` | ❌ VAISC計算 | `VAISC計算` | `response.totalProductCount` | `VAISC計算` |

### 最上位レスポンス構造

| データ項目 | 既存APIレスポンスフィールド | サンプルAPIデータ | DBフィールド | サンプルDBデータ | VAISCフィールド | サンプルVAISCデータ |
|-----------|---------------------------|-----------------|-------------|----------------|-----------------|-------------------|
| リダイレクトURL | `redirectURL` | `null` | ❌ リダイレクト処理 | `リダイレクト処理` | `response.redirectUrl` | `リダイレクト処理` |
| ナビゲーションタイトル | `searchContent.naviTreeTitle` | `"○I○I web channel TOP"` | ❌ 固定値 | `固定値` | `response.navigationTitle` | `固定値` |
| ナビゲーションURL | `searchContent.naviTreeUrl` | `"http://voi.0101.co.jp/..."` | ❌ 固定値 | `固定値` | `response.navigationUrl` | `固定値` |
| カラー表示選択肢 | `searchContent.colorDisplay` | `["全色表示", "代表色"]` | ❌ 固定値 | `固定値` | `response.colorDisplayOptions` | `固定値` |
| 価格表示フラグ | `searchContent.showPrice` | `true` | ❌ 固定値 | `固定値` | `response.showPrice` | `固定値` |
| ソート選択肢 | `searchContent.sortMenu` | `❌` | ❌ VAISC未対応 | `sortByList配列` | ❌ | ❌ |

### カラー商品詳細レスポンス

| データ項目 | 既存APIレスポンスフィールド | サンプルAPIデータ | DBフィールド | サンプルDBデータ | VAISCフィールド | サンプルVAISCデータ |
|-----------|---------------------------|-----------------|-------------|----------------|-----------------|-------------------|
| カラー別商品ID | `colorProducts[].productId` | `"CF0212351201_01"` | `s_product_id` | ※同値 | `product.variants[].id` | ※同値 |
| カラーID | `colorProducts[].colorId` | `"brown"` | `sm_color_id` | ※同値 | `product.variants[].attributes.color_id.text[0]` | ※同値 |
| カラー名 | `colorProducts[].colorName` | `"ブラウン"` | `sm_color_search` | ※同値 | `product.variants[].colorInfo.colors[0]` | ※同値 |
| カラー別価格 | `colorProducts[].taxInclusivePrice` | `4990` | `i_tax_inclusive_price` | ※同値 | `product.variants[].priceInfo.price` | ※同値 |
| カラー別定価 | `colorProducts[].oldPrice` | `5490` | `i_old_price` | ※同値 | `product.variants[].priceInfo.originalPrice` | ※同値 |
| カラー別割引率 | `colorProducts[].discountRate` | `9` | `i_discount_rate` | ※同値 | `product.variants[].attributes.discount_rate.numbers[0]` | ※同値 |
| カラー別フラグ | `colorProducts[].flags` | `{"sale": false, "newarrival": true}` | 複数フラグフィールド: `i_icon_flag_sale`, `i_icon_flag_newarrival`, etc. | sale: `0`, newarrival: `1` | `product.variants[].attributes.flag_*.text[0]` | `0→"false", 1→"true"変換` |
| カラー別詳細URL | `colorProducts[].detailUrl` | `❌` | `url` | `"https://voi.0101.co.jp/..."` | ❌ VAISC未対応 | ❌ |
| カラー別画像URL | `colorProducts[].imageURL` | `❌` | `s_thumb_img` | `"https://image.0101.co.jp/..."` | ❌ VAISC未対応 | ❌ |

## 📊 Menu APIレスポンスマッピング

### ファセット情報レスポンス

| データ項目 | 既存APIレスポンスフィールド | サンプルAPIデータ | DBフィールド | サンプルDBデータ | VAISCフィールド | サンプルVAISCデータ |
|-----------|---------------------------|-----------------|-------------|----------------|-----------------|-------------------|
| ブランドファセット | `brand[].brandList[].id`, `brand[].brandList[].nameJp`, `brand[].brandList[].count` | `{"id": "30001", "nameJp": "アーヴェヴェ", "count": 123}` | `s_web_brand_code` | ※同値 | `response.facets.brand_code.buckets[]` | ※同値 |
| カテゴリファセット | `item[].scdList[].id`, `item[].scdList[].name`, `item[].scdList[].count` | `{"id": "30162", "name": "ニット・セーター", "count": 123}` | 第1カテゴリ: `sm_primary_item`, 第2カテゴリ: `sm_secondary_item` | 第1: `30001`, 第2: `30162` | `response.facets.category_code.buckets[]` | `コード→名称変換` |
| 価格帯ファセット | `price.bottom`, `price.top` | `{"bottom": 1000, "top": 50000}` | `i_tax_inclusive_price` | `4990` | `response.facets.price_range.buckets[]` | `価格帯集計変換` |
| サイズファセット | `size[].id`, `size[].name`, `size[].count` | `{"id": "90001", "name": "フリー", "count": 234}` | サイズID: `sm_size_id`, サイズ名: `sm_size_search` | ID: `"90001"`, 名称: ※同値 | `response.facets.size_id.buckets[]` | `ID→名称変換` |
| カラーファセット | `color[].id`, `color[].name`, `color[].count` | `{"id": "white", "name": "ホワイト", "count": 567}` | カラーID: `sm_color_id`, カラー名: `sm_color_search` | ID: `"brown"`, 名称: ※同値 | `response.facets.color_id.buckets[]` | `ID→名称変換` |
| フラグファセット | `saleOption[]`, `arrivalOption[]`, `gift`, `coupon`, `used[]`, `offrate[]` | `{"id": "1", "name": "新着", "count": 567}` | 全フラグフィールド: `i_icon_flag_sale`, `i_icon_flag_newarrival`, `i_icon_flag_used`, etc. | `1` | `response.facets.flags.buckets[]` | `フラグ集計変換` |

### 追加ファセット情報レスポンス

| データ項目 | 既存APIレスポンスフィールド | サンプルAPIデータ | DBフィールド | サンプルDBデータ | VAISCフィールド | サンプルVAISCデータ |
|-----------|---------------------------|-----------------|-------------|----------------|-----------------|-------------------|
| ギフト対象商品数・選択状態 | `gift.count`, `gift.isSelected` | `{"count": 0, "isSelected": false}` | `i_icon_flag_giftwrap` | `0` | `response.facets.flag_giftwrap.buckets[]` | `{"count": 0, "isSelected": false}` (フラグ値→オブジェクト変換) |
| クーポン対象商品数・選択状態 | `coupon.count`, `coupon.isSelected` | `{"count": 0, "isSelected": false}` | `i_icon_flag_coupon` | `0` | `response.facets.flag_coupon.buckets[]` | `{"count": 0, "isSelected": false}` (フラグ値→オブジェクト変換) |
| 新品/中古分類 | `used[].id`, `used[].name`, `used[].count` | `[{"id": "0", "name": "新品", "count": 456}]` | `i_icon_flag_used` | `0` | `response.facets.flag_used.buckets[]` | `0→"新品"変換` |
| 価格範囲 | `price.bottom`, `price.top` | `{"bottom": 1000, "top": 50000}` | `i_tax_inclusive_price` | `1000, 50000` | ❌ VAISC未対応 | ❌ |
| セール選択肢 | `saleOption[].id`, `saleOption[].name`, `saleOption[].count` | `[{"id": "1", "name": "セール", "count": 123}]` | 販売状態フラグ | `0` | `response.facets.flags.buckets[]` | `フラグ集計変換` |
| 割引率選択肢 | `offrate[].id`, `offrate[].name`, `offrate[].count` | `[{"id": "30", "name": "30%OFF以上", "count": 234}]` | `i_discount_rate` | `9` | `response.facets.discount_rate.buckets[]` | `割引率範囲集計変換` |
| 新着/再入荷選択肢 | `arrivalOption[].id`, `arrivalOption[].name`, `arrivalOption[].count` | `[{"id": "1", "name": "新着", "count": 567}]` | 新着・再入荷フラグ | `1` | `response.facets.flags.buckets[]` | `フラグ集計変換` |

### 検索コンテキスト情報レスポンス

| データ項目 | 既存APIレスポンスフィールド | サンプルAPIデータ | DBフィールド | サンプルDBデータ | VAISCフィールド | サンプルVAISCデータ |
|-----------|---------------------------|-----------------|-------------|----------------|-----------------|-------------------|
| 検索クエリ | `freeword` | `"ニット"` | ❌ VAISC計算 | `VAISC計算` | `request.query` | `VAISC計算` |
| 除外キーワード | `exword` | `""` | ❌ VAISC計算 | `VAISC計算` | `request.filter` | `VAISC計算` |
| 検索結果タイトル | `title` | `"ニット・セーター"` | ❌ VAISC計算 | `VAISC計算` | `response.title` | `VAISC計算` |
| カテゴリマッピング | `fcdScdMap[].fcdId`, `fcdScdMap[].scdId` | `[{"fcdId": "0001", "scdId": "30001"}]` | 第1・第2カテゴリコード: `sm_primary_item`, `sm_secondary_item` | ※同値 | ❌ VAISC未対応 | ❌ |
| 人気キーワード | `popularKeywords[].param`, `popularKeywords[].value`, `popularKeywords[].label` | `[{"param": "bcd", "value": {"childId": "30143", "name": "アディダス"}, "label": "ブランド"}]` | 人気キーワード | ※同値 | ❌ VAISC未対応 | ❌ |

### 特徴キーワードレスポンス

| データ項目 | 既存APIレスポンスフィールド | サンプルAPIデータ | DBフィールド | サンプルDBデータ | VAISCフィールド | サンプルVAISCデータ |
|-----------|---------------------------|-----------------|-------------|----------------|-----------------|-------------------|
| キーワードグループID・名称 | `keyword[].groupId`, `keyword[].groupName` | `{"groupId": "G0001", "groupName": "素材・組成"}` | キーワードグループテーブル: `sm_keyword_group_id`, `sm_keyword_group_name` | ID: ※同値, 名称: ※同値 | `response.facets.keyword_groups.buckets[]` | `{"groupId": "G0001", "groupName": "素材・組成"}` (オブジェクト構造変換) |
| 特徴キーワード | `keyword[].keywordList[].keywordId`, `keyword[].keywordList[].keywordName`, `keyword[].keywordList[].count` | `[{"keywordId": "A0166", "keywordName": "コットン・綿", "count": 345}]` | `sm_keywords_text` | `"A0166", "コットン・綿"` | `response.facets.keywords.buckets[]` | `キーワード変換` |

## 📋 VAISCレスポンス構造


### VAISC標準レスポンス構造

```json
{
  "products": [
    {
      "id": "CF0212351201",
      "title": "ニットTシャツ",
      "uri": "https://voi.0101.co.jp/...",
      "priceInfo": {
        "currencyCode": "JPY",
        "price": 4990,
        "originalPrice": 5490
      },
      "brands": ["アイテムズ アーバンリサーチ"],
      "categories": ["ファッション", "レディース", "ニット・セーター"],
      "images": [
        {
          "uri": "https://image.0101.co.jp/...",
          "height": 400,
          "width": 300
        }
      ],
      "audience": {
        "genders": ["female"]
      },
      "colorInfo": {
        "colors": ["ブラウン", "ホワイト", "ブラック"]
      },
      "sizes": ["フリー", "M", "L"],
      "attributes": [
        {
          "key": "brand_code",
          "value": {"text": ["30095"]}
        },
        {
          "key": "discount_rate", 
          "value": {"numbers": [9]}
        },
        {
          "key": "flag_newarrival",
          "value": {"text": ["true"]}
        },
        {
          "key": "comment_count",
          "value": {"numbers": [2]}
        },
        {
          "key": "evaluation_average",
          "value": {"numbers": [4.5]}
        }
      ]
    }
  ],
  "totalProductCount": 847,
  "pagination": {
    "currentPage": 1,
    "pageSize": 20
  },
  "facets": {
    "brand_code": {
      "buckets": [
        {"value": "30095", "count": 23}
      ]
    },
    "price_range": {
      "buckets": [
        {"value": "3000-5000", "count": 15}
      ]
    }
  }
}
```

## 📊 全体互換性サマリー

### Search APIレスポンス互換性
- **商品基本情報**: 100% 対応（6/6項目）
- **ブランド情報**: 100% 対応（3/3項目）
- **価格情報**: 100% 対応（3/3項目）
- **ユーザー評価**: 100% 対応（3/3項目）
- **フラグ情報**: 93% 対応（13/14項目）- `flags.pricerereduced` 未対応
- **特別機能**: 50% 対応（1/2項目）- `couponThumbnail` 未対応
- **カラー表示**: 100% 対応（2/2項目）
- **ページング・メタ情報**: 100% 対応（3/3項目）
- **最上位レスポンス構造**: 83% 対応（5/6項目）- `sortMenu` 未対応
- **カラー商品詳細**: 78% 対応（7/9項目）- `detailUrl`, `imageURL` 未対応

### Menu APIレスポンス互換性
- **基本ファセット情報**: 100% 対応（6/6項目）
- **追加ファセット情報**: 86% 対応（6/7項目）- `price.bottom/top` 未対応
- **検索コンテキスト情報**: 60% 対応（3/5項目）- `fcdScdMap`, `popularKeywords` 未対応
- **特徴キーワード**: 100% 対応（2/2項目）

### 総合互換率
- **全体互換率**: **86% (65/76項目)**
- **Search API**: **88% (45/51項目)** 
- **Menu API**: **80% (20/25項目)**
- **未対応項目**: 11項目

#### 未対応項目一覧
**Search API**:
1. `flags.pricerereduced` - 再値下げフラグ
2. `couponThumbnail` - クーポンサムネイル
3. `sortMenu` - ソート選択肢
4. `colorProducts[].detailUrl` - カラー別詳細URL
5. `colorProducts[].imageURL` - カラー別画像URL

**Menu API**:
6. `price.bottom/top` - 価格範囲
7. `fcdScdMap` - カテゴリマッピング
8. `popularKeywords` - 人気キーワード

> **📌 注意**: 実際のVAISC APIでの動作確認による検証が必要です