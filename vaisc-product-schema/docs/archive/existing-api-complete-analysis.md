# 既存API完全分析 - Search/Menu API (factor=freeword)

## 1. API基本仕様

### 1.1 対象エンドポイント
- **Search API**: `GET /api/search`
- **Menu API**: `GET /api/menu`
- **共通条件**: `factor=freeword` 時の機能

### 1.2 必須パラメータ
- `factor`: "freeword" (必須)
- `q`: フリーワード検索文字列 (factor=freewordの場合必須)

## 2. 検索機能の詳細分析

### 2.1 フリーワード検索機能
| パラメータ | 説明 | 形式 | 例 |
|-----------|------|------|-----|
| `q` | ユーザー入力による検索 | +区切りで複数指定可能 | `カバン+メンズ` |
| `adw` | 絞り込みUI内のキーワード検索 | +区切りで複数指定可能 | `カバン` |
| `exq` | 除外キーワード検索 | +区切りで複数指定可能 | `トート` |

### 2.2 フィルタリング機能

#### 2.2.1 カテゴリ階層フィルタ
| パラメータ | 説明 | 値の例 | 備考 |
|-----------|------|--------|------|
| `store` | 大分類(store > fcd > scd) | 1:ファッション, 2:キッズ, 3:コスメ, 4:スポーツ, 5:スイーツ, 6:インテリア, 7:生活雑貨, 8:電化製品, 9:おもちゃ・ゲーム・ホビー, 10:書籍・音楽映像ソフト, 11:アニメ・キャラクター系グッズ | カンマ区切りで複数選択可能 |
| `fcd` | 第1カテゴリコード | 10000 | カンマ区切りで複数指定可能 |
| `scd` | 第2カテゴリコード | 10004 | カンマ区切りで複数指定可能 |

#### 2.2.2 属性フィルタ
| パラメータ | 説明 | 値の例 | 備考 |
|-----------|------|--------|------|
| `figure` | 性別 | 1:レディース, 2:メンズ, 3:ガール, 4:ボーイ, 5:ホーム | カンマ区切りで複数選択可能 |
| `bcd` | ブランドコード | 10799 | カンマ区切りで複数指定可能 |
| `price` | 価格範囲 | "0_10000" (下限_上限) | 1つまで |
| `size` | サイズコード | 40005 | カンマ区切りで複数指定可能 |
| `color` | カラー | black | カンマ区切りで複数指定可能 |
| `offrate` | オフ率 | 40 (40%以上) | 1つまで |
| `kwd` | 特徴コード | "G0007_A0224" (group_kwd形式) | カンマ区切りで複数指定可能 |

#### 2.2.3 日付フィルタ
| パラメータ | 説明 | 形式 | 例 |
|-----------|------|------|-----|
| `new_date` | 新着(入荷)日 | 開始_終了 (yyyymmdd_yyyymmdd) | "20200213_20200226" |
| `sale_date` | セール日 | 開始_終了 (yyyymmdd_yyyymmdd) | "20200213_20200226" |

#### 2.2.4 商品フラグフィルタ
| パラメータ | 説明 | 備考 |
|-----------|------|------|
| `arrival` | 新着/再入荷商品 | |
| `sale` | セール商品 | |
| `gift` | ギフトラッピング可能商品 | |
| `limitedsale` | 期間限定セール商品 | |
| `salespromotion` | 販促キャンペーン商品 | |
| `shipfree` | 送料無料商品 | |
| `preorder` | 先行予約商品 | |
| `used` | 中古商品 | |
| `coupon` | クーポン対象商品 | |
| `bulkdiscount` | まとめ割対象商品 | |
| `secretsale` | シークレットセール商品 | |

#### 2.2.5 その他フィルタ
| パラメータ | 説明 | 値 | 備考 |
|-----------|------|-----|------|
| `shop` | ショップ | oimodel | 実店舗 |
| `wno` | WEBショップ | | |
| `floor` | フロア(カテゴリの集合体) | "sb_l_all" | カンマ区切りで複数指定可能 |

### 2.3 ソート・ページング機能
| パラメータ | 説明 | 備考 |
|-----------|------|------|
| `sortby` | ソート順 | 詳細値要確認 |
| `page` | ページ番号 | |
| `per` | 1ページあたりの件数 | |

### 2.4 表示制御機能
| パラメータ | 説明 | 値 | デフォルト |
|-----------|------|-----|----------|
| `full` | 色表示制御 | 0:代表色, 1:全色表示 | 1 |
| `display_dreni` | ドレニ商品表示フラグ | 0:非表示, 1:表示 | 0 |

## 3. レスポンス構造の詳細分析

### 3.1 トップレベル構造
```json
{
  "redirectURL": "string",
  "searchContent": {
    // 検索結果の詳細
  }
}
```

### 3.2 searchContent構造
```json
{
  "naviTreeTitle": "string",
  "naviTreeUrl": "string", 
  "products": [],
  "nowPage": "integer",
  "per": "integer",
  "total": "integer",
  "sortMenu": [],
  "colorDisplay": {},
  "showPrice": "boolean"
}
```

### 3.3 商品情報(products)の詳細構造

#### 3.3.1 必須フィールド
| フィールド | 型 | 説明 |
|-----------|-----|------|
| `productId` | string | 商品ID |
| `flags` | object | フラグ情報 |

#### 3.3.2 商品基本情報
| フィールド | 型 | 説明 | 例 |
|-----------|-----|------|-----|
| `detailUrl` | string | 商品詳細ページURL | //voi.0101.co.jp/voi/webcatalog/... |
| `taxInclusivePrice` | integer | 税込価格 | 2796 |
| `oldPrice` | integer | 二重価格表示用 | 0 |
| `discountRate` | integer | 割引率(%) | 0 |

#### 3.3.3 ブランド情報
| フィールド | 型 | 説明 | 例 |
|-----------|-----|------|-----|
| `brandTextJP` | string | ブランド名称(日本語) | ヴェリココ/ラクチンきれいシューズ |
| `brandTextEN` | string | ブランド名称(英語) | velikoko |

#### 3.3.4 商品名・説明
| フィールド | 型 | 説明 | 例 |
|-----------|-----|------|-----|
| `productName1` | string | 商品の名前 | 【19.5～27.0cm】2Wayファーパンプス（1.5cmヒール） |
| `productName2` | string | 商品の属するブランドの日本語名+英語名 | パープル＆イエロー（レディース）（Purple & Yellow） |

#### 3.3.5 画像・メディア
| フィールド | 型 | 説明 | 例 |
|-----------|-----|------|-----|
| `imageURL` | string | メイン画像へのURL | https://voi.0101.co.jp/voi/webcatalog/img/... |

#### 3.3.6 ユーザー評価情報
| フィールド | 型 | 説明 | 例 |
|-----------|-----|------|-----|
| `commentCount` | integer | ユーザーコメント数 | 0 (nullあり) |
| `evaluationAverage` | float | ユーザー平均評価 | 0.0~5.0 |
| `favoriteCount` | integer | お気に入り登録数 | (nullあり) |

#### 3.3.7 カテゴリ情報
| フィールド | 型 | 説明 | 例 |
|-----------|-----|------|-----|
| `scdName` | string | アイテムカテゴリ名称 | パンプス |

#### 3.3.8 特別情報
| フィールド | 型 | 説明 | 例 |
|-----------|-----|------|-----|
| `couponThumbnail` | string | クーポンのサムネイル | 1000円クーポン対象商品 |
| `bulkDiscountMessage` | string | まとめ割のメッセージ | 2点以上で10%OFF |

#### 3.3.9 色関連情報
| フィールド | 型 | 説明 |
|-----------|-----|------|
| `colorProducts` | array | 色玉表示用（代表色表示時のみ） |

### 3.4 フラグ情報(flags)の詳細構造
| フィールド | 型 | 説明 |
|-----------|-----|------|
| `pricereduced` | boolean | 値下げフラグ |
| `pricerereduced` | boolean | 再値下げフラグ |
| `sale` | boolean | セールフラグ |
| `giftwrap` | boolean | ギフトラッピングフラグ |
| `rearrival` | boolean | 再入荷フラグ |
| `newarrival` | boolean | 新着フラグ |
| `limitedsale` | boolean | 期間限定セールフラグ |
| `salespromotion` | boolean | 販促キャンペーンフラグ |
| `deliveryfeeoff` | boolean | 配送料無料フラグ |
| `secretsale` | boolean | シークレット販売フラグ |
| `reservation` | boolean | 先行予約フラグ |
| `used` | boolean | 中古商品フラグ |
| `coupon` | boolean | クーポンフラグ |
| `bulkdiscount` | boolean | まとめ割フラグ |

### 3.5 その他レスポンス要素

#### 3.5.1 ソートメニュー(sortMenu)
```json
[
  {
    "id": "string",
    "name": "string", 
    "isSelected": "boolean",
    "order": "integer"
  }
]
```

#### 3.5.2 色表示制御(colorDisplay)
```json
[
  {
    "name": "全色表示",
    "selected": true
  },
  {
    "name": "代表色", 
    "selected": false
  }
]
```

## 4. Search API と Menu API の違い

### 4.1 共通パラメータ
- 基本的に同じパラメータセットを使用
- factor=freewordの場合の動作は類似

### 4.2 レスポンス形式の違い
- Search API: SearchResponse
- Menu API: MenuResponse
- レスポンス構造の詳細な違いは要確認

## 5. 機能要件まとめ

### 5.1 検索機能
1. **基本フリーワード検索**: 複数キーワード対応（+区切り）
2. **絞り込み検索**: 検索結果の追加絞り込み
3. **除外検索**: 特定キーワードを含む商品の除外

### 5.2 フィルタリング機能
1. **階層カテゴリ**: 3階層（store > fcd > scd）
2. **属性フィルタ**: 性別、ブランド、価格、サイズ、カラー、割引率、特徴
3. **日付フィルタ**: 新着日、セール日（2週間範囲）
4. **フラグフィルタ**: 14種類の商品状態フラグ
5. **その他**: ショップ、フロア、表示制御

### 5.3 表示・制御機能
1. **ソート**: sortbyパラメータ（詳細値要調査）
2. **ページング**: ページ番号、件数指定
3. **色表示**: 代表色/全色切り替え
4. **特定商品制御**: ドレニ商品表示/非表示

### 5.4 取得情報
1. **商品基本**: ID、名称、価格、画像、URL
2. **ブランド**: 日本語名、英語名
3. **カテゴリ**: アイテムカテゴリ名称
4. **ユーザー評価**: コメント数、評価平均、お気に入り数
5. **フラグ**: 14種類のブーリアンフラグ
6. **特別情報**: クーポン、まとめ割メッセージ
7. **色展開**: 色玉表示用データ

## 6. 次のステップ: DB項目とのマッピング分析
この詳細分析を基に、DB項目との対応関係と不足情報を特定する。