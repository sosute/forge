# 開発ルール

## Git ワークフロー
- すべての変更は feature ブランチで行う
- main ブランチへの直接コミットは禁止
- 必ずプルリクエストを作成してからマージする

## ブランチ命名規則
- `feature/issue-{番号}-{概要}` 形式
- 例: `feature/issue-4-remove-bookmarklet`

## 必須手順
1. Issue対応時は必ずfeatureブランチを作成
2. **作業時は@serena-expert agentを利用**（コード解析・影響範囲調査）
3. 作業完了後はプルリクエストを作成
4. PRのタイトルは「Fix #{Issue番号}: 説明」形式でIssueと連携（日本語で記述）

## コミットメッセージ規則
- **日本語で記述する**（コミットメッセージ、PRタイトル、PR説明文は全て日本語）
- 明確で説明的なメッセージを使用
- Issueと関連する場合は「refs #Issue番号」を含める
- 例: `不要なbookmarkletフォルダを削除 refs #4`

## 品質管理とベストプラクティス

### 必須品質チェック
**コミット前に必ず実行**:
```bash
cd chrome-extension
npm run quality  # lint + format + build の統合チェック
```

### 品質スクリプト詳細
- `npm run lint` - ESLintによる自動修正
- `npm run lint:check` - ESLintチェックのみ（修正なし）
- `npm run format` - Prettierによるコード整形
- `npm run format:check` - フォーマットチェックのみ
- `npm run quality` - 全品質チェック + ビルド確認

### 実行タイミング（重要度順）
1. **PR作成前** ⭐⭐⭐⭐⭐: `npm run quality` で品質保証（**最重要**）
2. **コミット前**: `npm run quality` で最終品質確認
3. **コード変更後**: `npm run lint` で即座に問題修正
4. **Issue対応開始時**: 依存関係とビルド確認
5. **マージ後**: プロジェクト全体の動作確認（健全性チェック）

### 品質チェック失敗時の対応
**ESLint-Prettier競合エラーの解決**:
```bash
# 1. ESLintで自動修正
npm run lint

# 2. Prettierでフォーマット
npm run format

# 3. 最終確認
npm run quality
```

**よくある競合**: インデント、クォート、末尾カンマの設定差異
**解決策**: `.eslintrc.cjs`と`.prettierrc`の設定を統一済み

### コードレビュー基準
- ESLintエラーゼロ（警告は要相談）
- Prettierフォーマット準拠
- ビルド成功必須
- 変更理由の明確な説明
- 影響範囲の適切な調査
- **PR作成前の品質チェック完了必須**

### 継続的品質向上
- 月次でESLintルール見直し
- パフォーマンス指標の監視
- 技術的負債の定期的な返済計画

## GitHub開発サイクル ベストプラクティス

### Issue管理
- **明確なタイトル**: 絵文字 + 問題/機能の要約
- **詳細な説明**: 背景、期待結果、受け入れ条件
- **優先度ラベル**: High/Medium/Low で分類
- **工数見積**: 実装予想時間をコメントで記録

### ブランチ戦略
- **命名の一貫性**: `feature/issue-{番号}-{英語概要}`
- **小さな単位**: 1つのIssueは1つのPRに対応
- **早期プッシュ**: 作業開始時にドラフトPRを作成
- **定期同期**: long-runningブランチは定期的にmainをマージ

### PR品質管理
- **テンプレート活用**: 変更概要、テスト項目、影響範囲を記載
- **レビュー要求**: 重要な変更は必ずレビュアーを指定
- **自己レビュー**: PRを作成前に自分でdiffを確認
- **継続的改善**: PRごとにプロセス改善点を記録

### リリース管理
- **セマンティックバージョニング**: MAJOR.MINOR.PATCH形式
- **チェンジログ**: 各リリースで変更内容を文書化
- **ロールバック計画**: 問題発生時の戻し手順を事前定義
- **依存関係更新**: 月次で脆弱性スキャンと更新

### Chrome拡張機能バージョン管理
**バージョン更新タイミング**:
1. **PATCH更新 (0.0.1)**: バグ修正、軽微な改善
   - PR作成時に`manifest.json`のバージョンを更新
   - 例: 1.0.0 → 1.0.1
   
2. **MINOR更新 (0.1.0)**: 新機能追加、中規模な改善
   - 新機能のPR作成時に更新
   - 例: 1.0.1 → 1.1.0
   
3. **MAJOR更新 (1.0.0)**: 破壊的変更、大規模リニューアル
   - 互換性を損なう変更時に更新
   - 例: 1.1.0 → 2.0.0

**更新手順**:
```bash
# 1. manifest.jsonのversion更新
# 2. git add manifest.json
# 3. コミットメッセージに「version: X.X.X」を含める
# 4. PR説明にバージョン変更内容を記載
```

**バージョン競合の防止策**:
1. **PR作成時はバージョン更新を保留**
   - 開発中は`manifest.json`のバージョンを変更しない
   - PR説明に「予定バージョン: X.X.X」を記載
   
2. **マージ直前にバージョン更新**
   - PRレビュー完了後、マージ前に最新のmainブランチを取り込む
   - その時点の最新バージョンを確認して適切に更新
   - 競合する場合は番号を調整

3. **バージョン管理の一元化**
   - 複数PR同時進行時は、マージ順に応じて番号を調整
   - 例: PR#1が1.0.1なら、PR#2は1.0.2に変更

### セキュリティ
- **機密情報管理**: .env、APIキーは絶対にコミットしない
- **依存関係監査**: `npm audit` を定期実行
- **アクセス権管理**: 必要最小限の権限設定
- **セキュリティ更新**: 緊急パッチは優先対応

### パフォーマンス監視
- **ビルドサイズ**: バンドルサイズの定期チェック
- **実行時パフォーマンス**: Chrome DevToolsでの定期測定
- **メモリリーク**: 長時間実行テストの実施
- **ユーザ体験**: 実際の使用環境での動作確認

## Claude自動化範囲（更新版）

### Issue対応の完全自動化
Claude Codeに「gh issue #X を対応してください」と依頼すると以下を自動実行：

1. **事前調査・準備**
   - Issue内容の確認と理解
   - **@serena-expert agentによる深い解析実施**
   - プロジェクトコード全体を精査し、変更箇所を正確に把握
   - 影響範囲の調査（関連ファイル検索）
   - メンテナンス性と可読性を考慮した実装計画
   - 依存関係とビルド確認
   - 作業計画の立案

2. **品質重視の実装**
   - featureブランチ自動作成
   - コード変更・ファイル操作
   - **依頼された機能のみ実装（未依頼の機能追加やUI変更は禁止）**
   - 既存コードのスタイルと一貫性を保持
   - **品質チェック統合実行（`npm run quality`）**
   - ESLint自動修正とフォーマット
   - ビルド成功確認

3. **品質保証済みPR作成**
   - 最終品質チェック通過確認
   - 日本語コミットメッセージでcommit
   - リモートブランチへpush
   - 詳細な日本語PRタイトル・説明文でPR作成
   - Issue番号との自動連携

### マージ後クリーンアップ自動化
「マージ後のクリーンアップをお願いします」で以下を実行：

1. **環境整理**
   - mainブランチへの切り替え
   - リモートから最新取得
   - 作業済みfeatureブランチ削除

2. **品質確認**
   - Issue状況確認
   - **プロジェクト品質チェック実行**
   - ビルド・テスト正常性確認
   - 次の作業候補提示

### 品質自動化のメリット
- **一貫した品質**: 全PRでESLint・Prettierチェック実行
- **早期発見**: コミット前に問題を検出・修正
- **効率化**: 手動チェック作業の自動化
- **安全性**: ビルド失敗の防止とリスク軽減
- **保守性**: コードスタイル統一による可読性向上

### 使用コマンド例
```bash
# 品質保証付きIssue対応
gh issue #2 を対応してください

# マージ後の品質確認付きクリーンアップ  
マージ後のクリーンアップをお願いします

# 手動品質チェック
cd chrome-extension && npm run quality
```